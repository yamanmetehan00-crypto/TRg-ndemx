<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Tutu'nun Macerası</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f0f0f0; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
canvas { border:2px solid #007BFF; background:#fff; touch-action: none; }
#score { margin:10px; font-weight:bold; font-size:18px; }
#message { margin-top:10px; font-weight:bold; color:green; text-align:center; }
button { margin-top:10px; padding:10px 20px; border:none; border-radius:5px; background:#007BFF; color:white; cursor:pointer; }
</style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="500"></canvas>
<div id="score">Kalpler: 0 / 10</div>
<div id="message"></div>
<button onclick="window.location.href='index.html'">Ana Sayfaya Dön</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const player = {x:180, y:440, width:40, height:40, color:'blue'};
let hearts = [];
let obstacles = [];
let score = 0;
const targetScore = 30;

// Kalp oluştur
function spawnHearts(){
  hearts = [];
  for(let i=0;i<10;i++){
    hearts.push({x:Math.random()*(canvas.width-30), y:Math.random()*(canvas.height-150), width:30, height:30, color:'red'});
  }
}

// Engel oluştur
function spawnObstacles(){
  obstacles = [];
  for(let i=0;i<5;i++){
    obstacles.push({x:Math.random()*(canvas.width-30), y:Math.random()*(canvas.height-150), width:30, height:30, color:'black'});
  }
}

// Çarpışma kontrolü
function collision(a,b){
  return a.x < b.x+b.width && a.x+a.width > b.x && a.y < b.y+b.height && a.y+a.height > b.y;
}

// Oyuncu hareketi
let keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Mobil için dokunmatik kontrol
let touchStartX=null, touchStartY=null;
canvas.addEventListener('touchstart', e=>{
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
});
canvas.addEventListener('touchmove', e=>{
  if(!touchStartX || !touchStartY) return;
  const dx = e.touches[0].clientX - touchStartX;
  const dy = e.touches[0].clientY - touchStartY;
  player.x += dx; player.y += dy;
  if(player.x<0) player.x=0; if(player.x+player.width>canvas.width) player.x=canvas.width-player.width;
  if(player.y<0) player.y=0; if(player.y+player.height>canvas.height) player.y=canvas.height-player.height;
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
});

function updatePlayer(){
  const step=5;
  if(keys['ArrowLeft'] || keys['a']) player.x -= step;
  if(keys['ArrowRight'] || keys['d']) player.x += step;
  if(keys['ArrowUp'] || keys['w']) player.y -= step;
  if(keys['ArrowDown'] || keys['s']) player.y += step;

  // Canvas sınırları
  if(player.x<0) player.x=0; if(player.x+player.width>canvas.width) player.x=canvas.width-player.width;
  if(player.y<0) player.y=0; if(player.y+player.height>canvas.height) player.y=canvas.height-player.height;
}

// Oyun döngüsü
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Oyuncu
  updatePlayer();
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // Kalpler
  hearts.forEach((h, idx)=>{
    ctx.fillStyle = h.color;
    ctx.fillRect(h.x, h.y, h.width, h.height);
    if(collision(player,h)){
      hearts.splice(idx,1);
      score++;
      document.getElementById('score').innerText = `Kalpler: ${score} / ${targetScore}`;
      if(score >= targetScore){
        document.getElementById('message').innerText = "Tebrikler! Tutu artık mutlu bir şekilde yattı!";
      }
    }
  });

  // Engeller
  obstacles.forEach(o=>{
    ctx.fillStyle = o.color;
    ctx.fillRect(o.x,o.y,o.width,o.height);
    if(collision(player,o)){
      // Engel çarpışması: geri it
      player.x -= 10;
      player.y -= 10;
    }
  });

  if(score < targetScore) requestAnimationFrame(gameLoop);
}

spawnHearts();
spawnObstacles();
gameLoop();
</script>

</body>
</html>